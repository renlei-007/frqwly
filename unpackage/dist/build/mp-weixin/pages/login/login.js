(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"06b3":function(e,o,n){"use strict";var t=n("c685"),s=n.n(t);s.a},3218:function(e,o,n){"use strict";var t;n.d(o,"b",(function(){return s})),n.d(o,"c",(function(){return i})),n.d(o,"a",(function(){return t}));var s=function(){var e=this,o=e.$createElement;e._self._c},i=[]},"6d30":function(e,o,n){"use strict";n.r(o);var t=n("3218"),s=n("a1c6");for(var i in s)"default"!==i&&function(e){n.d(o,e,(function(){return s[e]}))}(i);n("06b3");var a,r=n("f0c5"),c=Object(r["a"])(s["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],a);o["default"]=c.exports},"7cc0":function(e,o,n){"use strict";(function(e){n("41a1");t(n("66fd"));var o=t(n("6d30"));function t(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,n("543d")["createPage"])},a1c6:function(e,o,n){"use strict";n.r(o);var t=n("cd21"),s=n.n(t);for(var i in t)"default"!==i&&function(e){n.d(o,e,(function(){return t[e]}))}(i);o["default"]=s.a},c685:function(e,o,n){},cd21:function(e,o,n){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=r(n("1a55")),s=r(n("c5c5")),i=r(n("53643")),a=r(n("66fd"));function r(e){return e&&e.__esModule?e:{default:e}}var c={data:function(){return{userform:{username:"",password:"",is_thing:!1},is_phone:!1,is_click_login:!1,session_key:"",id:"",user_info:{}}},onLoad:function(e){this.is_thing=e.is_thing},methods:{goBindTel:function(o){var n=this;console.log(o);var t=o.detail.userInfo;console.log(t),e.login({provider:"weixin",success:function(e){console.log(e),n.doLogin(t,e.code)},fail:function(e){console.log(e)}})},getphone:function(o){var n=this;console.log(o);var i=o.detail;if("getPhoneNumber:ok"==i.errMsg){var r={appId:"1580387213331704",appKey:"Sd6qkHm9o4LaVluYRX5pUFyNuiu2a8oi",aesKey:"S9u978Q31NGPGc5H",ivKey:"X83yESM9iShLxfwS"},c=i.encryptedData,u=i.iv,d=this.session_key,l=t.default.getRand(),f=this.id,p=[];p[0]=["session_key",d],p[1]=["encryptedData",c],p[2]=["appId",r.appId],p[3]=["nonce_str",l],p[4]=["iv",u],p[5]=["userId",f];var g=s.default.createSign(p,r.appKey),y={encryptedData:i.encryptedData,iv:i.iv,session_key:this.session_key,appId:r.appId,nonce_str:l,sign:g,userId:f};this.request({url:"api/front/user/bindingPhone",data:y,complete:function(o){console.log(o),200==o.code?(n.user_info.phone=o.body.phoneNumber,e.setStorageSync("user_info",n.copyData(n.user_info)),e.showToast({title:"登录成功"}),a.default.prototype.isLogin=!0,n.is_thing?setTimeout((function(){e.navigateBack({delta:1})}),500):setTimeout((function(){e.reLaunch({url:"/pages/index/index"})}),500)):357==o.code?n.toast("该手机号已被注册，请使用手机号登录！","none"):n.toast(o.message,"none")}})}},doLogin:function(o,n){var i=this,r={appId:"1580387213331704",appKey:"Sd6qkHm9o4LaVluYRX5pUFyNuiu2a8oi",aesKey:"S9u978Q31NGPGc5H",ivKey:"X83yESM9iShLxfwS"},c=o.nickName,u=o.avatarUrl,d=(o.gender,o.province),l=o.city,f=o.country?o.country:"",p=t.default.getRand(),g=[],y=e.getStorageSync("shareCode");g[0]=["js_code",n],g[1]=["grant_type","authorization_code"],g[2]=["appId",r.appId],g[3]=["nonce_str",p],g[4]=["nickName",c],g[5]=["avatarUrl",u],g[6]=["province",d],g[7]=["city",l],g[8]=["country",f],g[9]=["shareCode",y];var h=s.default.createSign(g,r.appKey);this.request({url:"api/front/user/weixinLogin.jspx",data:{js_code:n,grant_type:"authorization_code",appId:r.appId,nonce_str:p,nickName:c,avatarUrl:u,province:d,city:l,country:f,shareCode:y,sign:h},complete:function(o){console.log(o),200==o.code&&i.getUser(o.body.username,o.body.sessionKey).then((function(n){if(console.log(n),201==n.code){e.setStorageSync("sessionKey",o.body.sessionKey),i.session_key=o.body.session_key,i.id=n.body.id;var t=n.body;i.user_info=n.body,e.setStorageSync("session_key",o.body.session_key),e.setStorageSync("user_info",t),a.default.prototype.isLogin=!0,void 0!=n.body.phone&&null!=n.body.phone&&n.body.phone.length>0?(e.showToast({title:"登录成功"}),i.is_thing?setTimeout((function(){e.navigateBack({delta:1})}),500):setTimeout((function(){e.reLaunch({url:"/pages/index/index"})}),500)):(i.is_click_login=!0,i.toast("请点击绑定手机授权登录"))}else i.toast(n.message,"none")})).catch((function(o){console.log(o),e.showToast({icon:"none",title:o.message})}))}})},login:function(){var o=this;if(""!=this.userform.username)if(""!=this.userform.password){var n={appId:"1580387213331704",appKey:"Sd6qkHm9o4LaVluYRX5pUFyNuiu2a8oi",aesKey:"S9u978Q31NGPGc5H",ivKey:"X83yESM9iShLxfwS"},r=t.default.getRand(),c=[],u=i.default.encrypt(this.userform.password,n.aesKey,n.ivKey);c[0]=["username",this.userform.username],c[1]=["aesPassword",u],c[2]=["appId",n.appId],c[3]=["nonce_str",r];var d=s.default.createSign(c,n.appKey);this.request({url:"user/login.jspx",data:{username:this.userform.username,aesPassword:u,appId:n.appId,nonce_str:r,sign:d},complete:function(n){if(console.log(n),304!=n.code)return 200!=n.code?(console.log(1),void e.showToast({title:n.message,icon:"none"})):void(200==n.code&&(console.log(2),o.getUser(o.userform.username,n.body).then((function(t){console.log(11111111),e.setStorageSync("sessionKey",n.body),console.log(t),e.setStorageSync("user_info",t.body),e.showToast({title:"登录成功"}),a.default.prototype.isLogin=!0,o.is_thing?setTimeout((function(){e.navigateBack({delta:1})}),500):setTimeout((function(){e.reLaunch({url:"/pages/index/index"})}),500)})).catch((function(o){console.log(o),e.showToast({icon:"none",title:o.message})}))));e.showToast({title:"密码错误",icon:"none"})}})}else this.toast("密码不能为空！","none");else this.toast("用户名不能为空！","none")},toReg:function(){e.navigateTo({url:"./register"})},toforget:function(){e.navigateTo({url:"./forget"})}}};o.default=c}).call(this,n("543d")["default"])}},[["7cc0","common/runtime","common/vendor"]]]);